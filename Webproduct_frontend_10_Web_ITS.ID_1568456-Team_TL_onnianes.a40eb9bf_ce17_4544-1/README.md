# Фронтенд мониторинга пациентов реанимации

Аннотация: в этом проекте ты в составе команды напишешь фронтенд, который будет эмулировать реанимационный монитор.

## Содержание

1. [Chapter I](#chapter-i) \
   1.1. [Рекомендации к проекту](#рекомендации-к-проекту)
2. [Chapter III](#chapter-iii) \
   2.1. [Задание 1](#задание-1-базовое-приложение) \
   2.2. [Задание 2](#задание-2-начало-разработки-приложения) \
   2.3. [Задание 3](#задание-3-описание-структуры-данных) \
   2.4. [Задание 4](#задание-4-взаимодействие-с-api) \
   2.5. [Задание 5](#задание-5-метрики-пациент) \
   2.6. [Задание 6](#задание-6-графики-пациента) \
   2.7. [Задание 7](#задание-7-карточка-пациента) \
   2.8. [Задание 8](#задание-8-главное-окно-приложения) \
   2.9. [Задание 9](#задание-9-запуск-и-отладка) \
   2.10. [Бонусное задание 10](#бонусное-задание-10-использование-приложения-из-прошлого-занятия)


## Введение 

Перед финальной встречей с клиентами оказалось, что у вас еще не готов фронтенд. Поэтому ты попросил Вениамина и Клариссу прийти немного позже, а сам с новоиспеченной командой взялся за дело. Главврач, проходя мимо по каким-то своим делам, в очередной раз воскликнул:

>— Какой ты молодец!
>>**Главврач**

Его слова напомнили тебе о том, что он всегда узнавал о твоих успехах первее всех, и ты задумчиво посмотрел на камеры видеонаблюдения. Впрочем, сейчас не было времени об этом думать — надо было закончить работу в срок. 

## Chapter I
### Рекомендации к проекту

Как учиться в «Школе 21»:

- На протяжении всего курса ты будешь самостоятельно добывать информацию. Пользуйся всеми доступными средствами поиска информации, к примеру, Google и GigaChat. Будь внимателен к источникам информации: проверяй, думай, анализируй, сравнивай.
- Взаимообучение (P2P, Peer-to-Peer) — это процесс, при котором учащиеся обмениваются знаниями и опытом, выступая одновременно в роли учителей и учеников. Этот подход позволяет учиться не только у преподавателя, но и друг у друга, что способствует более глубокому пониманию материала.
- Не стесняйся просить помощи: вокруг тебя такие же пиры, которые тоже проходят этот путь впервые. Не бойся откликаться на просьбы о помощи. Твой опыт ценен и полезен, смело делись им с другими участниками.
- Не списывай, а если пользуешься помощью — всегда разбирайся до конца, почему, как и зачем. Иначе твое обучение не будет иметь никакого смысла.
- Если ты на чем-то застрял и кажется, что все уже перепробовал, но по-прежнему непонятно, куда идти, — просто передохни! Поверь, этот совет помогал многим разработчикам в их работе. Проветрись, перезагрузи голову, и, возможно, в следующий раз тебе наконец придет нужное решение!
- Важен не только результат обучения, но и сам процесс. Нужно не просто решить задачу, а понять, КАК ее решить.

Как работать с проектом:
- Вся работа выполняется на виртуальной машине. Для начала ее нужно настроить, воспользовавшись [инструкцией](https://applicant.21-school.ru/guide_vm_med). Далее запустить виртуальную машину и продолжать выполнять работу над проектом там.
- Перед выполнением проект необходимо склонировать с GitLab в одноименный репозиторий.
- Все файлы с кодом необходимо создавать в папке src склонированного репозитория.
- После клонирования проекта необходимо создать ветку `develop` и вести разработку в ней. После этого пушить в GitLab также нужно ветку `develop`.
- В твоей директории не должно быть иных файлов, кроме тех, что обозначены в заданиях.

Дисклеймер:

- Наша команда не медики. Если ты будешь видеть в тексте медицинские неточности или ошибки, заранее просим у тебя прощения. Оставляй нам обратную связь, и мы все поправим!
- Иногда повествование ведется в несколько шутливой форме, чтобы не было скучно. Однако, как ты и сам знаешь, юмор и шутки — субъективная вещь. Поэтому если каламбуры в данном тексте, по твоему мнению, попахивают батиным юмором, то, пожалуйста, просто прими это.

## Chapter II

В этом проекте ты займешься фронтендом: создашь `SPA` (Single Page Application), который отображает графики и важные метрики пациента.

`React.js` — это `JavaScript`-библиотека для удобной разработки интерфейсов, то есть внешней части сайтов и приложений, с которой взаимодействует пользователь.

_Изучи, какие фишки у нее есть и почему многие любят ее использовать._

Ключевая особенность React.js — использование компонентов и управления их состоянием. 

Компоненты представляют собой отдельные фрагменты кода, которые отвечают за отображение конкретных частей интерфейса веб-сайта или приложения. При этом компоненты можно вкладывать друг в друга, создавая сложные иерархии.

Состояние хранит всю динамическую информацию, связанную с компонентом, включая данные, влияющие на его отображение. Например, для объекта «термометр» состояние может включать такие свойства, как `current_temperature` (текущая температура), `min` (минимальная температура) и `max` (максимальная температура).

_Изучи, какие фишки у нее есть и почему многие любят использовать эту библиотеку._

React активно используется в индустрии для создания современных, отзывчивых веб-приложений.

На проекте ты будешь писать на `TypeScript` и почувствуешь его сильные стороны на живом примере.

### Задание 1. Базовое приложение

Для работы над фронтендом тебе понадобится источник данных — если у тебя получилось полностью выполнить предыдущий проект, используй его как источник данных (данные по API из `monitor_service`) или, если не хочется / не получается работать с тем проектом, заведи небольшое приложение, которое будет иметь два эндпоинта:
- `GET /patients` — получение списка пациентов;
- `GET /patient/{patient_uuid}/metrics` — получение метрик пациента.

И по этим эндпоинтам будут наполнены данные — несколько пациентов (минимум 2), у каждого несколько записей метрик (хотя бы 10 записей у каждого).

❗️ Если получится поработать с приложением из предыдущего занятия — получишь зачтенное бонусное задание! :)

### Задание 2. Начало разработки приложения

Настало время фронтенда! Совсем скоро все данные, которые сейчас видны только текстом при ручном запросе к API, будут отображаться на экране.

Ваша команда может придумать свой дизайн или взять базовый вариант (в проекте уже есть `monitor.fig`).

1. Положи бэкенд приложения в `src` в папку `backend` и сделай новую папку `frontend`.
2. В папке `frontend` инициализируй react-приложение.
  __Если не знаешь, что это и как сделать, [изучи документацию React](https://ru.react.dev/learn).__
3. Установи зависимости:

    ```bash
    npm install @emotion/react @emotion/styled @mui/icons-material @mui/material axios chart.js 
    npm install chartjs-adapter-date-fns chartjs-plugin-zoom date-fns react-chartjs-2 recharts typescript
    ```

### Задание 3. Описание структуры данных

В TypeScript есть жесткая привязка к типам данных — это его сильная сторона.

1. Сделай папку `types`, в которой создай файл `types.ts`.
2. Опиши в нем `PatientMetric` и `Patient`.

### Задание 4. Взаимодействие с API

Чтобы отображать данные, надо откуда-то их получать. :) Напиши взаимодействие с API:

1. В папке `services` создай файл `api.ts` и напиши функции для взаимодействия с API.
2. Создай экземпляр axios для выполнения HTTP-запросов.
3. Создай функции:
  - `getPatients` — функция для получения списка пациентов;
  - `getPatientMetrics` — функция для получения метрик пациента.

### Задание 5. Метрики пациента

Все получаемые метрики отображай в виде карточек (снова посмотри на примерный дизайн).

1. В папке `components` создай файл `CurrentMetrics.tsx` и напиши логику для отображения текущих показателей пациента.
2. Здесь сделай логику обработки пороговых значений — воспользуйся константами `THRESHOLDS` и установи значения.

Пример описания констант с пороговыми значениями:
 
    ```typescript
    const THRESHOLDS = {
     HEART_RATE: {MIN: 60, MAX: 100, CRITICAL_MIN: 40, CRITICAL_MAX: 190},
     SPO2: {MIN: 95, CRITICAL_MIN: 90},
     TEMPERATURE: {MIN: 36, MAX: 37.5, CRITICAL_MIN: 35, CRITICAL_MAX: 39},
     SYSTOLIC_PRESSURE: {MIN: 100, MAX: 140, CRITICAL_MIN: 90, CRITICAL_MAX: 180},
     DIASTOLIC_PRESSURE: {MIN: 60, MAX: 90, CRITICAL_MIN: 50, CRITICAL_MAX: 120}
     };
     ```
 
3. Установи три зоны: зеленая, желтая, красная, в зависимости от показаний.
4. При обновлении метрик должны меняться отображаемые показатели.
5. Страница не должна обновляться полностью, обновляются только метрики и графики.

Для реализации обновления данных без полной перезагрузки страницы:
1. Организуй начальный рендеринг страницы.
2. Настрой механизм получения обновленных данных.
3. Обновляй только состояние нужных компонентов.

### Задание 6. Графики пациента

Покажи исторические данные из API в виде графика. Для этого воспользуйся фреймворком `chartjs`.

1. В папке `components` создай файл `PatientMetricsChart.tsx` и напиши логику для отображения графиков показателей пациента.
2. Пусть каждый показатель будет на отдельном графике (давление не показывай).
3. График должен обновляться при каждом поступлении данных по API.
4. График должен иметь возможность масштабирования.
5. График должен сохранять масштаб после обновления.
6. Обновляться должны только график и метрики, а не вся страница.

### Задание 7. Карточка пациента

В `components` создай файл `PatientCard.tsx` и напиши логику для отображения карточки пациента с графиками и текущими метриками.

1. Добавь компонент `PatientMetricsChart` для отображения графиков метрик.
2. Добавь компонент `CurrentMetrics` для отображения текущих метрик.

### Задание 8. Главное окно приложения

Создай файл `App.tsx` в директории `src` и напиши логику для загрузки данных пациентов, обработки ошибок и отображения интерфейса.

1. Сделай функцию `fetchPatients`, в которой опиши получение списка пациентов с сервера:

    - На главной странице пусть будет `select`, в который будут подгружаться все пациенты из БД.

2. Сделай функцию `fetchMetrics`, в которой опиши получение метрик выбранного пациента:

    - При выборе пациента в `select` сюда будет перенаправляться uuid для вычитки метрик из БД.

3. Сделай `handlePatientChange` — это будет обработчик изменения выбранного пациента:

    - При выборе нового пациента пусть немедленно запрашиваются новые данные.

4. Сделай `handleCloseErrorMessage` — это будет обработчик закрытия сообщения об ошибке:
  - Заведи переменную `connectionIssue`, поставь ее в `true`, если будешь получать с бэкенда ошибку.
  - Показывай ошибку в виде сообщения, которое можно закрыть.
  - При восстановлении коннекта (эндпоинт снова присылает данные) перекрась ошибку в зеленый цвет и сообщение замени на положительное. Пусть оно закроется через 2 секунды.

### Задание 9. Запуск и отладка

Скорее всего, ты не раз уже увидел ошибки при запуске — не переживай, это совершенно нормально. :) Часто бывают ошибки с типами из-за TS, иногда возникают ошибки получения данных, парсинга и т. д. В этом задании тебе предстоит полностью отладить приложение.

1. Убедись, что при запуске приложения с выключенным бэкендом не происходит падения — пусть будет сообщение, что данных нет.
2. Убедись, что не возникает ошибок при работе в штатном варианте (посмотри консоль разработчика и панель сетевых запросов).

### Бонусное задание 10. Использование приложения из прошлого занятия

Если у тебя получилось поработать со своими микросервисами в этом проекте, ты и твоя команда — молодцы! И вы вместе выполнили условие этого задания.

Вот и все! У тебя получилось изучить столько всего нового! За все это время ты посмотрел, как работает Django, сколько у Django всего доступно сразу «из коробки», как строится фронтенд, как работает React, что такое SPA. Ты изучил FastApi, посмотрел на работу с другой БД — SQLite, применил TypeScript, попробовал использовать очень много фреймворков, которые помогали тебе разрабатывать функционал приложений. :)

Ты большой молодец! Впереди еще большой путь, но ты уже идешь по нему.

Перед экзаменом вспомни всю теорию, что изучил, пока разрабатывал свои приложения, и как следует поспи, чтобы мозг отдохнул и был готов к вопросам! 

--- 

Приложение наконец было готово — готово целиком и полностью. Ты мог вздохнуть с облегчением и, наверное, немного расслабиться. Весь этот процесс, когда тебя окунули с головой в незнакомую отрасль, показался несколько стрессовым, но при этом ты столько всего узнал. И без помощи некоторых! 

Тем временем этот «некоторый» как раз нарисовался около тебя. 

>— Мой дорогой стажер, поздравляю тебя с завершением этого крупного заказа от совсем не моих родственников. Я невероятно горжусь твоими успехами и тем, что ты самостоятельно смог во всем разобраться. Все это время я пристально следил за тобой...
>>**Главврач**

Вот оно. Ты все-таки дождался объяснений, почему Главврач тебя вообще на это все кинул. 

>— Ты, наверное, заметил, что моя поддержка приходила всегда вовремя...
>>**Главврач**

Скорее, пугающе и навязчиво, но это мелочи.

>— И я старался поддержать тебя на этом трудном пути...
>>**Главврач**

Бросил тебя в пекло, а сам уклонялся от работы, точно. Отличная поддержка. 

>— И вот теперь я готов объявить, что специально позвал Вениамина и Клариссу, чтобы на практике обучить тебя веб-разработке...
>>**Главврач**

О чем ты, кстати, совсем не просил. Но это детали.

>— С завтрашнего дня мы официально откроем отдел веб-разработки в нашей Лаборатории и будем и дальше работать с подобными заказами, а ты станешь нашим ведущим разработчиком. Поздравляю! Надеюсь, ты польщен.
>>**Главврач**

>— Нет, спасибо.
>>**Стажер**

Главврач недоуменно воззрился на тебя. 

>— Ах, ты прав! Сначала тебе надо сдать проект клиентам. Они сообщили, что также хотят поспрашивать тебя по деталям разработки — думаю, тебе не составит труда ответить. Молодец — смотришь только вперед и сразу замечаешь главное. Я не ошибся в выборе человека.
>>**Главврач**

>— Нет, подождите, я совсем не это имел в виду...
>>**Стажер**

Но Главврач похлопал тебя по плечу и ушел, бормоча под нос, какое замечательное семя он посадил. А ведь ты надеялся, что с вебом на этом все. Но кажется, это лишь новое начало... 

💡 [Нажми сюда](https://oprosso.ru/p/ad3bc98eb2a54c0baf4679fa722b54df), **чтобы поделиться с нами обратной связью на этот проект**. Это анонимно и поможет команде Продукта сделать твое обучение лучше.