# Формы и ввод данных

Аннотация: Этот проект предназначен для изучения ввода/вывода данных и их обработки.

## Содержание

1. [Chapter I](#chapter-i) \
   1.1. [Рекомендации к проекту](#рекомендации-к-проекту)
2. [Chapter II](#chapter-iii) \
   2.1. [Задание 1](#задание-1-базовое-приложение) \
   2.2. [Задание 2](#задание-2-создание-моделей) \
   2.3. [Задание 3](#задание-3-проведение-миграции-и-просмотр-админки) \
   2.4. [Задание 4](#задание-4-отображение-списка-данных) \
   2.5. [Задание 5](#задание-5-создание-врачей-через-форму) \
   2.6. [Задание 6](#задание-6-элементарная-валидация) \
   2.7. [Бонусное задание 7](#бонусное-задание-7-ошибки-и-статус-коды) \
   2.8. [Бонусное задание 8](#бонусное-задание-8-продвинутая-валидация) 

## Введение

>Вениамин и Кларисса снова пришли в Лабораторию, и у тебя начало складываться впечатление, что это они, а не ты, здесь работают. А в отсутствие Главврача они еще и стали твоей главной головной болью — клиенты, которые не знают, чего хотят: ни концепции, ни идеи... Неудивительно, что все остальные драгоценные коллеги разбежались. 
>
>Впрочем, сегодня Вениамин и Кларисса выглядели как-то по-особенному загадочно. Будто и впрямь просветлились.
>
>— Мы подумали и решили...
>>**Вениамин**
>
>— Неужели? Очень рад это слышать! 
>>**Стажер**
>
>— В общем, мы посмотрели вашу «рыбу»: очень интересно, но ничего не понятно. А где регистрация? Где список врачей? Где пациенты? Как все это увидеть?
>>**Кларисса**
>
>— Так это же еще только «рыба», ее нужно оборачивать в фольгу, так сказать. Я пока только показываю, а не продаю.
>>**Стажер**
>
>— Понятно. А можно посмотреть, что было бы, будь эта «фольга» у нас? 
>>**Вениамин**
>
>— Да, очень хотелось бы глянуть. 
>>**Кларисса**
>
>Создается ощущение, что просветления ты достигнешь раньше них — с такой-то прокачкой терпения. 

## Chapter I
### Рекомендации к проекту

Как учиться в «Школе 21»:

- На протяжении всего курса ты будешь самостоятельно добывать информацию. Пользуйся всеми доступными средствами поиска
  информации, к примеру, Google и GigaChat. Будь внимателен к источникам информации: проверяй, думай, анализируй,
  сравнивай.
- Взаимообучение (P2P, Peer-to-Peer) — это процесс, при котором учащиеся обмениваются знаниями и опытом, выступая
  одновременно в роли учителей и учеников. Этот подход позволяет учиться не только у преподавателя, но и друг у друга,
  что способствует более глубокому пониманию материала.
- Не стесняйся просить помощи: вокруг тебя такие же пиры, которые тоже проходят этот путь впервые. Не бойся откликаться
  на просьбы о помощи. Твой опыт ценен и полезен, смело делись им с другими участниками.
- Не списывай, а если пользуешься помощью — всегда разбирайся до конца, почему, как и зачем. Иначе твое обучение не
  будет иметь никакого смысла.
- Если ты на чем-то застрял, и кажется, что ты уже все перепробовал, но все равно непонятно, куда идти, — просто
  передохни! Поверь, этот совет помогал многим разработчикам в их работе. Проветрись, перезагрузи голову и, возможно, в
  следующий раз тебе наконец придет нужное решение!
- Важен не только результат обучения, но и сам процесс. Нужно не просто решить задачу, а понять, КАК ее решить.

Как работать с проектом:
- Вся работа выполняется на виртуальной машине. Для начала ее нужно настроить, воспользовавшись [инструкцией](https://applicant.21-school.ru/guide_vm_med). Далее запустить виртуальную машину и продолжать выполнять работу над проектом там.
- Перед выполнением проект необходимо склонировать с GitLab в одноименный репозиторий.
- Все файлы с кодом необходимо создавать в папке src склонированного репозитория.
- После клонирования проекта необходимо создать ветку `develop` и вести разработку в ней. После этого пушить в GitLab
  также нужно ветку `develop`.
- В твоей директории не должно быть иных файлов, кроме тех, что обозначены в заданиях.

Дисклеймер:

- Наша команда не медики. Если ты будешь видеть в тексте медицинские неточности или ошибки, заранее просим у тебя
  прощения. Оставляй нам обратную связь, и мы все поправим!
- Иногда повествование ведется в несколько шутливой форме, чтобы не было скучно. Однако, как ты и сам знаешь, юмор и
  шутки — субъективная вещь. Поэтому если каламбуры в данном тексте, по твоему мнению, попахивают батиным юмором, то,
  пожалуйста, просто прими это.


## Chapter II
В этом проекте ты создашь модели для основных структур данных, научишь приложение отправлять, принимать, валидировать и
обрабатывать данные.

### Задание 1: Базовое приложение
Чтобы продолжать работу над приложением, тебе понадобится:
- Django-проект и приложение,
- страница `/doctors` с карточками врачей.

Ты можешь скопировать файлы из предыдущего проекта и продолжать работу над ними или создать новое приложение и выполнять задания из этого проекта.

### Задание 2: Создание моделей
Простыми словами, модель — логическое определение объектов, его свойств и прочих элементов. В разработке используют модели
для конечного определения объектов, которыми оперирует ПО. Причем некоторые свойства могут опускаться в том или ином случае, 
если они не важны в бизнес-логике (например, у врача есть еще много параметров: его вес, семейное положение и т. д., — но 
в случае этого приложения данные параметры не несут бизнес-ценности).

В текущем приложении будет несколько объектов — врач, пациент, кабинет и запись на прием. Начни с создания моделей (опиши их в файле `models.py`):

1. Создай схему в `draw.io` — это поможет визуально увидеть данные и их связи и подготовить документацию. Сделай следующие сущности:
   - врача (**Doctor**) — пусть у него будут поля doctor_id (тип uuid), fio (text), birth_date (date), available (boolean),
    specialty(text);
   - пациента (**Patient**) — у него будут поля patient_id (тип uuid), fio (text), birth_date (date),
     patient_age (integer), notes (text), prescriptions (json);
   - кабинет (**Room**) — room_id (int), room_name (text), available (boolean)
   - запись (**Appointment**) — appointment_id (uuid), doctor_id (uuid), patient_id (uuid), room_number(int),
     date (DateTime), notes (text), prescriptions (json), cancelled (boolean);
 2. Свяжи сущности — запись должна быть привязана к доктору, пациенту и кабинету (посмотри, что такое `models.ForeignKey`).
 3. Опиши модели и связи в коде соответственно логическим связям выше.

_Изучи: связи OneToOne, OneToMany, ManyToOne, ManyToMany._ 

_Для доступа в `/admin` потребуется создать супер-юзера._

### Задание 3: Проведение миграции и просмотр админки
Миграция (от слова migrations) в базах данных (далее БД) — это процесс обновления схемы БД в соответствии с изменениями в моделях приложения.  
Она обеспечивает автоматическую синхронизацию структуры без потери данных.

_Еще есть понятие миграции БД из старой версии в новую (например, с обогащением данных, отсечением ненужных и т. д.) — это другое понятие, связанное именно с переносом данных_

1. Создай и проведи миграции в БД.
2. Сделай так, чтобы эти модели можно было просматривать в админ-панели (`/admin`).
3. Сделай так, чтобы были видны все параметры при просмотре через админку (например, `doctor_id`, `room_id` и т. д.).
У тебя будут изменения в файле `admin.py` в результате этих действий.

### Задание 4: Отображение списка данных
Частый случай, когда нужно получить все данные из БД и отобразить их на фронтенде, чтобы пользователь мог увидеть 
в удобном виде все данные. Реши это проблему:
1. Добавь через админку несколько кабинетов.
2. Создай страничку `rooms.html` в папке `templates`.
3. Пусть эта страница будет доступна по адресу `/room/all` — добавь ее в `urls.py`.
4. На этой странице должен быть доступен список всех созданных кабинетов в виде таблицы — опиши во `views.py` логику 
получения всех кабинетов и передачу их в шаблон.
5. Не забывай обрабатывать разнообразные случаи — например, если кабинетов нет, необходимо выводить информацию об их отсутствии.

### Задание 5: Создание врачей через форму
Фреймворк Django позволяет достаточно быстро организовать работу по приему данных при помощи форм. 
1. Создай страничку `add_doctor.html` в папке `templates`.
2. Пусть эта страница будет доступна по адресу `/doctor/create/` — изменятся файлы `views.py` и `urls.py`.
3. По этой ссылке должна быть форма для создания врача:
   - нужно будет создать свою форму в файле `forms.py`;
   - форму сделай при помощи `django.forms` — `ModelForm`;
   - учти, что нужно описывать два типа `request.method` — `GET` и `POST` (один происходит при загрузке формы, другой — при отправке).
4. Проверь в панели `/admin`, что врачи создаются, а `doctor_id` проставляется автоматически.
5. Переведи вывод карточек на странице всех докторов в файле `doctors.html` по адресу `/doctors` на живые данные из БД. Выводи все данные,
   кроме `doctor_id`.

### Задание 6: Элементарная валидация

Не хотелось бы принимать пустые данные. И хорошо бы говорить пользователю,
если он сделал что-то не так. Пришло время внедрить валидацию полей.

1. Проверяй, чтобы `doctor_fio` и `specialty` не были пустыми.
2. При нарушении правил — выводить сообщение и не добавлять запись.

Для работы с этим заданием потребуются изменения в файле `forms.py`.

_Изучи Django messages framework._

### Бонусное задание 7: Ошибки и статус-коды

Не забывай следить за ошибками — в работе твоего приложения (в идеале) все возможные исключения должны быть
обработаны при помощи `try-except`.
_Рекомендация: посмотри, какие типы HTTP-кодов сообщений бывают, их полезно знать и применять._

Это задание может коснуться разных файлов, но как минимум сделай обработку ошибок во `views.py`.

### Бонусное задание 8: Продвинутая валидация

Может так получиться, что сразу после добавления новой записи пропал коннект или выпала неожиданная ошибка, не связанная с созданием врача. И получится, что в БД запись добавлена, а пользователь об этом не знает. Добавь механизм, который позволит:
1. Отслеживать, есть ли такой врач (`ФИО` + `ДР`) в БД.
2. Выдавать предупреждение, что такой врач уже существует, — показывать всю доступную о нем информацию (`ФИО+ДР+Специальность`).
3. Предоставлять пользователю выбор, добавить ли такого врача в БД, ведь может так произойти, что в одной больнице работают два врача с одной ФИО и одним ДР (маловероятно, но возможно).

Валидация вновь затронет файл `forms.py`.

---

>С некоторым пониманием того, что от тебя хотят, работа и правда пошла быстрее. Ты откинулся на спинку кресла и посмотрел на экран. Почти в тот же миг твой телефон завибрировал: новая СМС от Главврача.
>
>Отлично получилось! В этом проекте ты изучил базовые понятия БД, научился валидировать данные, отлавливать ошибки, работать в админке и добавлять данные через форму! Форму создавать, кстати, тоже научился тут! Все эти навыки сильно помогут в будущих проектах. Кстати, не мог бы ты сделать шрифт покрупнее — сам понимаешь, глаза старые. 
>>**Главврач**
>
>— ...
>>**Стажер**
>
>Ты молча увеличил шрифт на экране, еле сдерживаясь, чтобы не показать гримасу всей твоей радости в камеру видеонаблюдения. Когда он вернется — если вернется, потому что ты уже начинаешь сомневаться, — ты ему все выскажешь о защите частной жизни сотрудников. Мало ли что ты делаешь в Лаборатории, вдруг в носу ковыряешься во время написания кода? 

---
   
💡 [Нажми сюда](http://opros.so/jSVV1), **чтобы поделиться с нами обратной связью на этот проект**. Это анонимно и поможет команде Продукта сделать твое обучение лучше.