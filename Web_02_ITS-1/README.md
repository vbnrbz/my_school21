# Приложение для клинических исследований

Аннотация: Данный проект позволит тебе познакомиться с разработкой приложений на языке программирования Python с использованием веб-фреймворков или созданием чат-ботов, а также со взаимодействием с базой данных.

## Содержание
1. [Chapter I](#chapter-i) \
   1.1. [Рекомендации к проекту](#рекомендации-к-проекту)
2. [Chapter II](#chapter-ii) \
   2.1. [Описание проекта](#описание-проекта)
3. [Chapter III](#chapter-iii) \
   [Разработка приложения](#разработка-приложения)\
   3.1. [Задание 1](#интерфейс)\
   3.2. [Задание 2](#редактирование-базы-данных)  
   3.3. [Задание 3](#получение-данных) \
   3.4. [Задание 4](#обработка-сохранение-данных)\
   3.5. [Задание 5](#ответ-пользователю)


## Введение 
> День начался настолько прекрасно, что, казалось бы, ничто не могло его омрачить, что, собственно, и не произошло. Ведь, когда я проверял почту, то увидел заветное письмо от главврача.
>> **Стажер**

> Привет, студент! \
> Получил твое письмо с разработанной базой данных. Ты отлично поработал! Определенно вижу твой интерес, поэтому отправляю тебе следующий этап нашего масштабного проекта. Он предполагает разработку приложения для клинических исследований, которое будет взаимодействовать с пользователем, обрабатывать и сохранять данные, а также проводить простой анализ введенных данных. Приложение может быть как веб-приложением, так и чат-ботом.
> Все подробности изложены ниже. \

> Сообщи мне, как завершишь работу. \
> Посылаю в космос заговор на удачу! 

> С уважением и добрыми пожеланиями, \
заведующий ~~кафедры~~ кластера.
>> **Главврач**

> Ну кому как не мне перестать сидеть и начать действовать? Пора пролить на это дело чистую водицу!
>> **Стажер**

## Chapter I
### Рекомендации к проекту
Как учиться в «Школе 21»:  
- На протяжении всего курса ты будешь самостоятельно добывать информацию. Пользуйся всеми доступными средствами поиска информации, к примеру, Google и GigaChat. Будь внимателен к источникам информации: проверяй, думай, анализируй, сравнивай. 
- Взаимообучение (P2P, Peer-to-Peer) — это процесс, при котором учащиеся обмениваются знаниями и опытом, выступая одновременно в роли учителей и учеников. Этот подход позволяет учиться не только у преподавателя, но и друг у друга, что способствует более глубокому пониманию материала.
- Не стесняйся просить помощи: вокруг тебя такие же пиры, которые тоже проходят этот путь впервые. Не бойся откликаться на просьбы о помощи. Твой опыт ценен и полезен, смело делись им с другими участниками. 
- Не списывай, а если пользуешься помощью — всегда разбирайся до конца, почему, как и зачем. Иначе твое обучение не будет иметь никакого смысла. 
- Если ты на чем-то застрял, и кажется, что ты уже все перепробовал, но все равно непонятно, куда идти, — просто передохни! Поверь, этот совет помогал многим разработчикам в их работе. Проветрись, перезагрузи голову и, возможно, в следующий раз тебе наконец придет нужное решение!
- Важен не только результат обучения, но и сам процесс. Нужно не просто решить задачу, а понять, КАК ее решить.

Как работать с проектом: 
- Вся работа выполняется на виртуальной машине. Для начала ее нужно настроить, воспользовавшись [инструкцией](https://applicant.21-school.ru/guide_vm_med). Далее запустить виртуальную машину и продолжать выполнять работу над проектом там.
- Перед выполнением проект необходимо склонировать с GitLab в одноименный репозиторий.
- Все файлы с кодом необходимо создавать в папке src склонированного репозитория.
- После клонирования проекта необходимо создать ветку `develop` и вести разработку в ней. После этого пушить в GitLab также нужно ветку `develop`.
- В твоей директории не должно быть иных файлов, кроме тех, что обозначены в заданиях.
- Если на твоем компьютере не развернута виртуальная машина, то необходимо ее развернуть как ты делал в прошлом проекте. 

Дисклеймер: 
- Наша команда не медики. Если ты будешь видеть в тексте медицинские неточности или ошибки, заранее просим у тебя прощения. Оставляй нам обратную связь, и мы все поправим!
- Иногда повествование ведется в несколько шутливой форме, чтобы не было скучно. Однако, как ты и сам знаешь, юмор и шутки — субъективная вещь. Поэтому если каламбуры в данном тексте, по твоему мнению, попахивают батиным юмором, то, пожалуйста, просто прими это.

## Chapter II

### Описание проекта

Основная цель проекта — создать приложение (веб-приложение или чат-бот), которое будет взаимодействовать с пользователем, обрабатывать и сохранять данные, а также проводить простой анализ введенных данных. 
Предполагаемое реализуемое приложение выполняет следующий функционал:
- Запрашивает у пользователя:
  - ID;
  - Выбор исследования из доступных;
  - Оценку самочувствия по 100-балльной шкале;
  - Принимаемый препарат (из двух вариантов: «Плацебо» или другой препарат, доступный в исследовании).
- Анализирует введенные данные и сообщает пользователю, является ли его самочувствие нормальным для данного препарата в рамках исследования.
- Сохраняет всю информацию в базу данных из предыдущего проекта.

Разработка приложения осуществляется на языке программирования Python. Для его создания можно выбрать один из веб-фреймворков — `Django`, `FastAPI`, `Flask` — или создать чат-бота с использованием библиотек `pyTelegramBotAPI`, `aiogram`.

Подсказки по выбору веб-фреймворка:

- Django — наиболее полный фреймворк для создания веб-приложений. Он включает в себя всё необходимое для работы с БД, написания логики и отображения в HTML. Имеет встроенную админку и множество расширений. Если ты хочешь быстро создать веб-сайт и использовать проверенные инструменты, Django — отличный выбор. Он использует свою ORM для работы с БД.
- FastAPI — современный и популярный фреймворк, особенно для создания API. Он очень гибкий и удобный для разработки backend-приложений. Стоит выбрать его, если хочешь освоить трендовый инструмент. Для работы с БД часто используют ORM SQLAlchemy (ту же, что и в первом проекте), либо отправляют SQL-запросы напрямую в БД без ORM.
- Flask — легковесный фреймворк, который может быть при необходимости расширен. Он позволяет создавать как простые, так и сложные приложения. Если другие фреймворки по каким-то причинам не подошли, Flask может быть отличной альтернативой.

Подсказки по выбору библиотеки для работы с Telegram:

- pyTelegramBotAPI — самый простой вариант для быстрой разработки Telegram-бота. В нем есть все необходимое для начала работы.
- aiogram — асинхронная библиотека, которая эффективна при большом количестве пользователей. Требует понимания асинхронности в Python (async/await). Выбирай ее, если хочешь глубже погрузиться в разработку ботов и асинхронное программирование.

После прохождения каждого задания весь код и файлы, необходимые для запуска проекта, нужно скопировать в директорию `src/taskN`, где N — номер задания.

## Chapter III
### Разраработка приложения 

### Задание 1. Интерфейс

Первым делом необходимо реализовать интерфейс взаимодействия с пользователем. Ты сам выбираешь, как будет выглядеть интерфейс, но при этом он должен позволять пользователю:
    - Ввести ID пользователя.
    - Выбрать исследование из списка доступных. На данном этапе список можно «захардкодить», то есть зафиксировать неизменным в коде.
    - Ввести оценку самочувствия по 100-балльной шкале.
    - Выбрать принимаемый препарат (из двух вариантов: «Плацебо» или другой препарат, доступный в исследовании).
- Интерфейс должен быть понятным и не содержать лишних элементов.
- Все данные должны сразу же валидироваться:
    - ID должен быть неотрицательным числом.
    - Проверка, что выбран действительно элемент из списка исследований.
    - Оценка самочувствия должна быть от 0 до 100.
    - Препарат должен быть строкой и соответствовать допустимым вариантам.
- При вводе невалидных данных необходимо сразу сообщить о неверности введенных данных и попросить пользователя ввести корректные данные.

В результате должен быть рабочий код, который отображает элементы интерфейса пользователю при запросе. Интерфейс должен позволять вводить данные и валидировать данные. 
Весь код проекта скопируй в директорию `src/task1`.

Рекомендации:
- Для веб-приложения:
    - Создай HTML-страницу с полями ввода.
    - Используй шаблонизатор (Django Templates или Jinja2) для динамического отображения списка исследований.
- Для чат-бота:
    - Реализуй последовательность сообщений, на которые пользователь должен ответить.
    - Используй клавиатуру бота для удобного выбора из списка (если поддерживается библиотекой).

### Задание 2. Редактирование базы данных

После реализации интерфейса следует добавить новое поле в базу данных для хранения информации о тестируемом препарате в каждом исследовании. 

Для этого нужно в таблицу trials добавить столбец med типа VARCHAR(100). Это будет название тестируемого препарата в исследовании. Таким образом, в каждом исследовании будут использоваться два препарата: med и «Плацебо».

Способы выполнения:

1.	SQL-запрос:
- Напиши SQL-запрос для добавления столбца.
- Сохрани запрос в файле add_med.sql в корне проекта.
2.	Через ORM и миграции:
- Используй ORM выбранного фреймворка и систему миграций для изменения структуры базы данных.
- Автоматически сгенерируй миграцию (скрипт изменения БД).
- Добавь файл add_med.txt, в котором укажи расположение миграции на добавление столбца.

Результатом будет файл `add_med.txt` или `add_med.sql`. 
Весь код проекта скопируй в директорию `src/task2`.

Рекомендации по миграциям:
- Если используешь Django, создай модель с новым полем и сгенерируй миграцию с помощью python manage.py makemigrations.
- В Flask или FastAPI или чат-боте с SQLAlchemy также можно использовать механизмы миграций (например, Alembic).

### Задание 3. Получение данных

Для формирования списка доступных исследований тебе необходимо динамически получать данные из базы данных, выполнив следующие вводные:
- Запроси из базы данных все ID, названия и тестируемые препараты исследований с помощью SELECT.
- Сформируй список доступных исследований на основе полученных данных.
- При выборе принимаемого препарата необходимо проверить, что препарат относится к данному исследованию или что это «Плацебо».

**Важно**: запрашивать все строки из таблицы БД не всегда оптимально, особенно если данных много. Однако для целей данного проекта можно пренебречь этим и загрузить все исследования, так как объем данных невелик.

В результате, интерфейс пользователя должен предлагать пользователю выбрать доступное исследование и при вводе принимаемого препарата должна быть проверка, что препарат относится к выбранному исследованию. 
Весь код проекта скопируй в директорию `src/task3`.

Рекомендации:
- Используй ORM или прямые SQL-запросы для получения данных.
- Обнови интерфейс (веб-страницу или бота) так, чтобы список исследований был актуальным и соответствовал данным из базы.

### Задание 4. Обработка и сохранение данных

Следующий этап создания приложения предполагает сохранение введенных пользователем данных в базу данных. Прими во внимание следующие условия:
- После валидации и обработки данных сохрани новую запись в таблицу measurements с введенными значениями.
- Убедись, что все поля заполнены корректно и соответствуют типам данных в таблице.

В результате приложение должно уметь сохранять введенные пользователем данные. Весь код проекта скопируй в директорию `src/task4`.

Рекомендации:
- Используй ORM для удобного сохранения данных в базу.
- Обработай возможные ошибки при сохранении (например, проблемы с подключением к базе данных).

### Задание 5. Ответ пользователю

Последним завершающим действием следует проанализировать введенные данные и сообщить пользователю результат. Для этого необходимо:
- Рассчитать среднее значение поля condition_score для данного препарата в рамках выбранного исследования.
- Определить диапазон нормы: ±10% от среднего значения.
- Сравнить введенную пользователем оценку самочувствия с диапазоном нормы.
- Сообщить пользователю, выходит ли его самочувствие за пределы нормы или нет.

В результате, после того, как пользователь ввел данные, приложение должно проверять, входит ли самочувствие в норму или нет. Пользователь должен увидеть сообщение об его самочувствии. 
Весь код проекта скопируй в директорию `src/task5`.

Рекомендации:
- Используй агрегатные функции (например, AVG) для расчета среднего значения.
- Выполни соответствующий запрос к базе данных.
- Оформи ответ пользователю в удобном и понятном виде.

> Ура, работа над приложением завершена! Ждем,что будет дальше...
>> **Стажер**

💡 [Нажми сюда](http://opros.so/jSVV1), **чтобы поделиться с нами обратной связью на этот проект**. Это анонимно и поможет команде Продукта сделать твоё обучение лучше.
