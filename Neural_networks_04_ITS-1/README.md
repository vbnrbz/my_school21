# Нейронные сети в медицине
Аннотация: В этом проекте ты будешь использовать методы глубокого обучения для анализа медицинских изображений. 

## Содержание
1. [Chapter I](#chapter-i)  
   - [Рекомендации к проекту](#рекомендации-к-проекту)
2. [Chapter II](#chapter-ii)  
   - [Описание проекта](#описание-проекта)  
     1. [Краткое вводное по нейронным сетям для анализа изображений](#краткое-вводное-по-нейронным-сетям-для-анализа-изображений)  
     2. [Описание датасета chest_xray](#описание-датасета-chest_xray)  
     3. [Библиотеки для обучения нейронных сетей](#библиотеки-для-обучения-нейронных-сетей)
3. [Chapter III](#chapter-iii)
   - [Разработка сверточной нейронной сети](#разработка-сверточной-нейронной-сети) 
   - [Задание 1. Подготовка данных и окружения](#задание-1-подготовка-данных-и-окружения)  
   - [Задание 2. Создание и обучение нейронной сети](#задание-2-создание-и-обучение-нейронной-сети)  
   - [Задание 3. Оценка качества модели](#задание-3-оценка-качества-модели)  
   - [Бонусное задание 4. Аугментация данных](#бонусное-задание-4-аугментация-данных)


## Введение 
Ты идешь по коридору университета на очередную пару по расписанию, и вдруг навстречу идет, конечно же, главврач. Насколько прекрасный день, думаешь ты.

>Прекрасный день, студент! Пусть это солнышко, которое сегодня на небе, светит тебе в душу. Солнце — это и есть улыбка. Улыбайся себе, улыбайся всему миру вокруг. Радуйся жизни!
>>**Главврач**

> Здравствуйте! Да и облака сегодня такие голубые, красивые. В каждом из нас живет улыбка. Хорошего дня, солнечного в душе!
>>**Стажер**

>Студент, у меня для тебя есть предложение. Твоя плодотворная работа над проектом «Клинические исследования» прошла максимально эффективно. Знаю, как тебе сложно совмещать это с основной учебой, но предлагаю тебе снова стать стажером и вступить в нашу лабораторию при университете. Это будет супер-практика.
>>**Главврач**

> Предполагаю, отказы не принимаются, раз я уже тут столько месяцев. Согласен. Над каким следующим проектом мне предстоит работать? 
>>**Стажер**

> Это замечательно! Следующий проект направлен на разработку сверточной нейронной сети (CNN), способной классифицировать рентгеновские снимки лёгких на две категории: нормальные лёгкие и лёгкие с пневмонией.\
Все подробности пришлю на почту. Удачи! \
Мне пора на пару, и нам с тобой по пути.
>>**Главврач**

## Chapter I
### Рекомендации к проекту
Как учиться в «Школе 21»:  
- На протяжении всего курса ты будешь самостоятельно добывать информацию. Пользуйся всеми доступными средствами поиска информации, к примеру, Google и GigaChat. Будь внимателен к источникам информации: проверяй, думай, анализируй, сравнивай. 
- Взаимообучение (P2P, Peer-to-Peer) — это процесс, при котором учащиеся обмениваются знаниями и опытом, выступая одновременно в роли учителей и учеников. Этот подход позволяет учиться не только у преподавателя, но и друг у друга, что способствует более глубокому пониманию материала.
- Не стесняйся просить помощи: вокруг тебя такие же пиры, которые тоже проходят этот путь впервые. Не бойся откликаться на просьбы о помощи. Твой опыт ценен и полезен, смело делись им с другими участниками. 
- Не списывай, а если пользуешься помощью — всегда разбирайся до конца, почему, как и зачем. Иначе твое обучение не будет иметь никакого смысла. 
- Если ты на чем-то застрял, и кажется, что ты уже все перепробовал, но все равно непонятно, куда идти, — просто передохни! Поверь, этот совет помогал многим разработчикам в их работе. Проветрись, перезагрузи голову и, возможно, в следующий раз тебе наконец придет нужное решение!
- Важен не только результат обучения, но и сам процесс. Нужно не просто решить задачу, а понять, КАК ее решить.

Как работать с проектом: 
- Вся работа выполняется на виртуальной машине. Для начала ее нужно настроить, воспользовавшись [инструкцией](https://applicant.21-school.ru/guide_vm_med). Далее запустить виртуальную машину и продолжать выполнять работу над проектом там.
- Перед выполнением проект необходимо склонировать с GitLab в одноименный репозиторий.
- Все файлы с кодом необходимо создавать в папке `src` склонированного репозитория.
- После клонирования проекта необходимо создать ветку `develop` и вести разработку в ней. После этого пушить в GitLab также нужно ветку `develop`.
- В твоей директории не должно быть иных файлов, кроме тех, что обозначены в заданиях.
- При решении проекта воспользуйся датасетом `chest_xray` перейдя по [ссылке](https://disk.yandex.ru/d/VEIy4pYytapT3A). 
- Рекомендуется располагать фреймворк на диске АРМ, как и виртуалку в $HOME/goinfre/{PyTorch/Keras/TensorFlow}.


Дисклеймер: 
- Наша команда не медики. Если ты будешь видеть в тексте медицинские неточности или ошибки, заранее просим у тебя прощения. Оставляй нам обратную связь, и мы все поправим!
- Иногда повествование ведется в несколько шутливой форме, чтобы не было скучно. Однако, как ты и сам знаешь, юмор и шутки — субъективная вещь. Поэтому если каламбуры в данном тексте, по твоему мнению, попахивают батиным юмором, то, пожалуйста, просто прими это.

## Chapter II
### Описание проекта

#### Краткое вводное по нейронным сетям для анализа изображений

Нейронные сети — это математические модели, вдохновлённые работой человеческого мозга, которые используются для решения различных задач, включая классификацию изображений, распознавание речи, машинный перевод и многое другое. Сверточные нейронные сети (Convolutional Neural Networks, CNN) широко применяются для анализа изображений. Они способны автоматически выделять важные признаки из изображений и использовать их для классификации.

#### Описание датасета chest_xray

Ты будешь работать с датасетом [`chest_xray`](https://disk.yandex.ru/d/VEIy4pYytapT3A), который состоит из рентгеновских снимков грудной клетки, разделенных на две категории:
- `NORMAL`: изображения здоровых легких;
- `PNEUMONIA`: изображения лёгких с признаками пневмонии.

Датасет разделен на папки:
- `train` содержит изображения для обучения модели;
- `test` содержит изображения для тестирования модели.

В каждой из этих папок есть папки `NORMAL` и `PNEUMONIA`, содержащие соответствующие изображения в формате `.jpeg`.

Пример структуры датасета:
```
chest_xray/
├── train/
│   ├── NORMAL/
│   └── PNEUMONIA/
└── test/
    ├── NORMAL/
    └── PNEUMONIA/
```

Ты будешь использовать этот датасет для обучения нашей модели и последующей оценки ее качества на независимом наборе тестовых данных.

#### Библиотеки для обучения нейронных сетей

Для того чтобы обучить нейронную сеть, необходимо определиться с фреймворком глубокого обучения. Ты можешь выбрать из `Keras`, `TensorFlow` и `PyTorch`.

Самое простое — использовать `Keras`. Это удобное решение для обучения простых моделей. На практике в последние годы библиотеки Keras и Tensorflow утратили свою популярность и сейчас остаются удобными лишь для изучения основ нейронных сетей. Самый передовой фреймворк глубокого обучения — `Pytorch`. Он открывает огромное количество возможностей по созданию нейросетей.

Если хочешь просто ознакомиться с нейронными сетями — используй `Keras`. Если хочешь глубже вникнуть в нейросети и поработать с гибкими и современными инструментами — используй `PyTorch`.

От того, какую библиотеку ты выберешь, будет зависеть и то, как ты будешь загружать данные в модель.

### Chapter III
### Разработка сверточной нейронной сети

Перед выполнением заданий создай Jupyter Notebook `src/xray_nn.ipynb` и всю работу выполняй в этом ноутбуке.

### Задание 1. Подготовка данных и окружения

Для выполнения проекта тебе понадобятся следующие библиотеки:	
*	Python 3.7+;
*	Jupyter Notebook;
*	NumPy;
*	Pandas;
*	Matplotlib;
*	Keras (или PyTorch, или TensorFlow, на выбор студента).

1. Выполни загрузку двух изображений здоровых легких и двух изображений пораженных легких. Выведи эти изображения.
2. Датасет уже разделен на обучающий и тестовый, поэтому тебе необходимо лишь научиться отдавать эти данные нейронной сети. Изучи, как можно это сделать в библиотеке, которую ты выбрал для нейронных сетей. 
3. Загружая данные из датасета, необходимо привести значение пикселей изображения к промежутку [0, 1].

Сохрани весь код, комментарии и вывод ячеек в `xray_nn.ipynb`.

### Задание 2. Создание и обучение нейронной сети

1. Создай архитектуру CNN с помощью выбранного тобой фреймворка для классификации изображений:
    * Используй слои Conv2D, MaxPooling2D для извлечения признаков из изображений.
	* Используй слои Flatten и Dense слои для классификации.
	* Убедись, что на последнем слое сети используется функция активации sigmoid (так как задача бинарной классификации).
2. Установи функцию потерь, в данном задании подходит binary crossentropy.
3. Установи оптимизатор сети, например, adam или sgd.
4. Установи количество эпох (epochs). Рекомендуем начать с 10-20.
5. Установи размер батча (batch_size). Обычно используют значения 16, 32, 64. 
6. Обучи модель на тренировочном наборе данных.

Сохрани весь код, комментарии и вывод ячеек.

Рекомендации: экспериментируй с разными параметрами (количество слоев, количество фильтров, размер ядер свертки, функция активации, learning rate) для улучшения результатов.

### Задание 3. Оценка качества модели

После обучения модели нужно понять, насколько хорошо она справляется с задачей:
1. Протестируй модель на тестовой выборке, вычисли accuracy, precision, recall модели. Значение accuracy должно быть выше 80%, но для прохождения задания достаточно выше 70%.
2. Интерпретируй полученные результаты: запиши выводы о том, насколько хорошо модель справляется с задачей и какие возможны пути для дальнейшего улучшения.

Сохрани весь код, комментарии и вывод ячеек.

Рекомендации: используй встроенные функции TensorFlow/Keras для оценки модели (model.evaluate).

### Бонусное задание 4. Аугментация данных

Один из способов улучшения качества модели — увеличение объемов данных. Это можно делать разными способами, например, с помощью аугментации. Это техника, когда исходные данные подвергаются некоторым преобразованиям, создавая таким образом «новые» изображения. Например, можно наклонять изображение на разные углы, немного увеличивать или уменьшать изображение, отражать его. Такие данные для нейросети новые и могут сильно улучшить качество модели.

1. Выполни аугментацию данных. В аугментированный набор данных должны дополнительно попасть изображения, которые:
    * отражены по горизонтали,
    * приближены,
    * наклонены.
2. Повторно обучи нейросеть и протестируй ее на тестовом наборе, выведи точность полученной модели. Сделай выводы о технике аугментации: как изменились результаты после аугментации?

Сохрани весь код, комментарии и вывод ячеек.

💡 [Нажми сюда](http://opros.so/jSVV1), **чтобы поделиться с нами обратной связью на этот проект**. Это анонимно и поможет команде Продукта сделать твоё обучение лучше.
